---
- name: Install Powershell on Windows using Scoop
  community.windows.scoop:
    name: pwsh
    state: present
  when: ansible_os_family == 'Windows'

- name: "{{ role_name }} | Install PowerShell modules"
  win_shell: |
    Install-Module -Name PSReadLine -Scope CurrentUser -Force
    Install-Module -Name Terminal-Icons -Scope CurrentUser -Force
    Install-Module -Name PSFzf -Scope CurrentUser -Force
    Install-Module -Name Recycle -Scope CurrentUser -Force
  args:
    executable: pwsh.exe

- name: "{{ role_name }} | Create PowerShell config directories"
  win_file:
    path: "{{ item }}"
    state: directory
  loop:
    - "{{ ansible_user_profile }}\\Documents\\PowerShell"
    - "{{ ansible_user_profile }}\\.config\\powershell"

- name: "{{ role_name }} | Create main PowerShell profile"
  win_copy:
    content: ". $env:USERPROFILE\\.config\\powershell\\profile.ps1"
    dest: "{{ ansible_user_profile }}\\Documents\\PowerShell\\Microsoft.PowerShell_profile.ps1"

- name: "{{ role_name }} | Create actual PowerShell config"
  win_copy:
    src: profile.ps1
    dest: "{{ ansible_user_profile }}\\.config\\powershell\\profile.ps1"
